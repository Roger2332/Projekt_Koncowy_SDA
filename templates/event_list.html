{% extends "base.html" %}

{% block content %}
    <h1>Event list</h1>

    <!-- Formularz wyszukiwania -->
    <form method="GET" action="{% url 'search_event' %}">
        <input type="text" name="query" placeholder="Wpisz frazę" value="{{ request.GET.query }}">
        <select name="search_type">
            <option value="all" {% if request.GET.search_type == "all" %}selected{% endif %}>Wszystkie</option>
            <option value="future" {% if request.GET.search_type == "future" %}selected{% endif %}>Przyszłe</option>
            <option value="ongoing_future" {% if request.GET.search_type == "ongoing_future" %}selected{% endif %}>Trwające i przyszłe</option>
        </select>
        <button type="submit">Szukaj</button>
    </form>

    <table class="table">
        <tbody>
        {% for event in events %}
            <tr>
                <td><h2>{{ event.name }}</h2></td>
            </tr>
            <tr>
                <td>{{ event.start_at }} - {{ event.end_at }}</td>
            </tr>
            <tr>
                <td>Description: {{ event.description }}</td>
            </tr>
            <tr>
                <td>
                    <form id="subscribeForm{{ event.id }}" action="{% url 'subscribe_event' event.id %}" method="post" style="display: none;">
                        {% csrf_token %}
                    </form>
                    <button type="button" class="btn btn-primary subscribe-btn" data-event-id="{{ event.id }}">Subscribe</button>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script>
        document.querySelectorAll('.subscribe-btn').forEach(button => {
            button.addEventListener('click', function() {
                const eventId = this.getAttribute('data-event-id');
                const formId = `#subscribeForm${eventId}`;
                document.querySelector(formId).submit();
            });
        });
    </script>
{% endblock %}